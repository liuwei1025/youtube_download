# å­—å¹•çƒ§å½•åŠŸèƒ½ - å®Œæˆæ€»ç»“

## åŠŸèƒ½å®ç° âœ…

å·²æˆåŠŸä¸ºYouTubeä¸‹è½½å™¨æ·»åŠ äº†è‡ªåŠ¨å­—å¹•çƒ§å½•åŠŸèƒ½ï¼Œå®ç°äº†å°†ä¸‹è½½çš„å­—å¹•è‡ªåŠ¨åŠ åˆ°è§†é¢‘ä¸Šçš„éœ€æ±‚ã€‚

## å®ç°å†…å®¹

### 1. æ ¸å¿ƒåŠŸèƒ½ (src/youtube_downloader.py)

#### æ–°å¢å‡½æ•°
```python
burn_subtitles_to_video(video_path, subtitle_path, output_path)
```
- å°†VTTå­—å¹•æ–‡ä»¶çƒ§å½•åˆ°è§†é¢‘ä¸­
- æ”¯æŒä¸¤ç§çƒ§å½•æ–¹å¼ï¼ˆè‡ªåŠ¨æ£€æµ‹å’Œåˆ‡æ¢ï¼‰
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

#### æ–°å¢é…ç½®
```python
@dataclass
class DownloadConfig:
    ...
    burn_subtitles: bool = True  # é»˜è®¤å¯ç”¨å­—å¹•çƒ§å½•
```

#### æ–°å¢å‘½ä»¤è¡Œå‚æ•°
```bash
--no-burn-subtitles  # ç¦ç”¨å­—å¹•çƒ§å½•
```

#### è‡ªåŠ¨åŒ–é›†æˆ
- åœ¨`process_single_url()`ä¸­é›†æˆ
- ä¸‹è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œå­—å¹•çƒ§å½•
- ç”Ÿæˆæ–‡ä»¶: `{åŸæ–‡ä»¶å}_with_subs.mp4`

### 2. æµ‹è¯•ç”¨ä¾‹ (tests/test_youtube_downloader.py)

æ–°å¢æµ‹è¯•ç±» `TestSubtitleBurning`ï¼ŒåŒ…å«5ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

1. âœ… `test_burn_subtitles_success` - æµ‹è¯•æˆåŠŸçƒ§å½•
2. âœ… `test_burn_subtitles_missing_video` - æµ‹è¯•è§†é¢‘ä¸å­˜åœ¨
3. âœ… `test_burn_subtitles_missing_subtitle` - æµ‹è¯•å­—å¹•ä¸å­˜åœ¨  
4. âœ… `test_burn_subtitles_with_real_files` - ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•
5. âœ… `test_download_config_burn_subtitles_flag` - æµ‹è¯•é…ç½®æ ‡å¿—

**æµ‹è¯•ç»“æœ**: 41 passed, 1 skipped (100% æˆåŠŸç‡)

### 3. æ–‡æ¡£

åˆ›å»ºäº†3ä¸ªæ–‡æ¡£æ–‡ä»¶ï¼š

1. **docs/SUBTITLE_BURN_GUIDE.md**
   - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
   - é…ç½®é€‰é¡¹è¯´æ˜
   - æ•…éšœæ’é™¤
   - ç¤ºä¾‹ä»£ç 

2. **docs/FFMPEG_SETUP.md**
   - FFmpegå®‰è£…æŒ‡å—
   - åŠŸèƒ½æ£€æµ‹æ–¹æ³•
   - å¹³å°ç‰¹å®šè¯´æ˜

3. **tests/SUBTITLE_BURN_TEST_SUMMARY.md**
   - æµ‹è¯•ç»“æœæŠ¥å‘Š
   - åŠŸèƒ½å¯¹æ¯”
   - æŠ€æœ¯ç»†èŠ‚

## æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹å¼1: å­—å¹•æ»¤é•œï¼ˆæ¨èï¼‰
```bash
ffmpeg -i video.mp4 \
  -vf "subtitles=subtitle.vtt:force_style='FontSize=20,...'" \
  -c:a copy output.mp4
```
- âœ… å­—å¹•ç›´æ¥çƒ§å½•åˆ°ç”»é¢
- âš ï¸ éœ€è¦FFmpegæ”¯æŒlibass

### æ–¹å¼2: åµŒå…¥å­—å¹•æµï¼ˆå¤‡ç”¨ï¼‰
```bash
ffmpeg -i video.mp4 -i subtitle.vtt \
  -c:v libx264 -c:a copy -c:s mov_text \
  output.mp4
```
- âœ… æ ‡å‡†FFmpegå³å¯
- âš ï¸ éœ€è¦æ’­æ”¾å™¨æ”¯æŒ

### æ™ºèƒ½åˆ‡æ¢
ç¨‹åºè‡ªåŠ¨æ£€æµ‹FFmpegåŠŸèƒ½å¹¶é€‰æ‹©æœ€ä½³æ–¹å¼ï¼š
```python
if 'No such filter' in output:
    logger.info("å­—å¹•æ»¤é•œä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ...")
    # è‡ªåŠ¨åˆ‡æ¢åˆ°æ–¹å¼2
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```bash
python src/youtube_downloader.py "https://www.youtube.com/watch?v=VIDEO_ID" \
  --start 00:30 --end 02:00
```

ç”Ÿæˆæ–‡ä»¶ï¼š
```
downloads/VIDEO_ID/
â”œâ”€â”€ segment_00_30-02_00.mp4              # åŸå§‹è§†é¢‘
â”œâ”€â”€ segment_00_30-02_00_with_subs.mp4    # å¸¦å­—å¹•è§†é¢‘ â­
â”œâ”€â”€ audio_00_30-02_00.mp3
â””â”€â”€ subtitles_00_30-02_00.en.vtt
```

### ç¦ç”¨å­—å¹•çƒ§å½•
```bash
python src/youtube_downloader.py "URL" \
  --start 00:30 --end 02:00 \
  --no-burn-subtitles
```

### æ‰¹é‡å¤„ç†
```bash
python src/youtube_downloader.py \
  --batch urls.txt \
  --start 00:30 --end 02:00
```

## æµ‹è¯•éªŒè¯

### ä½¿ç”¨çœŸå®æ•°æ®æµ‹è¯•

ä½¿ç”¨ `downloads/1pw9ycK2krg/` ç›®å½•çš„æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼š

```bash
pytest tests/test_youtube_downloader.py::TestSubtitleBurning::test_burn_subtitles_with_real_files -v
```

**ç»“æœ**:
```
âœ… å­—å¹•çƒ§å½•æµ‹è¯•æˆåŠŸ:
  è§†é¢‘: segment_00_17-01_30.mp4
  å­—å¹•: subtitles_00_17-01_30.en.vtt  
  è¾“å‡º: segment_00_17-01_30_with_subs_test.mp4
  åŸå§‹å¤§å°: 1.73 MB
  è¾“å‡ºå¤§å°: 2.20 MB
```

### å®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
pytest tests/test_youtube_downloader.py -v
```

**ç»“æœ**: 41 passed, 1 skipped âœ…

## ç‰¹æ€§äº®ç‚¹

### âœ… è‡ªåŠ¨åŒ–
- ä¸‹è½½åè‡ªåŠ¨çƒ§å½•å­—å¹•
- æ— éœ€æ‰‹åŠ¨æ“ä½œ
- æ™ºèƒ½é”™è¯¯å¤„ç†

### âœ… å…¼å®¹æ€§
- æ”¯æŒå¤šç§FFmpegç‰ˆæœ¬
- è‡ªåŠ¨æ£€æµ‹å’Œé™çº§
- è·¨å¹³å°æ”¯æŒ

### âœ… å¯é…ç½®
- å¯å¯ç”¨/ç¦ç”¨
- æ”¯æŒå¤šè¯­è¨€å­—å¹•
- è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„

### âœ… é²æ£’æ€§
- å®Œå–„çš„é”™è¯¯å¤„ç†
- é‡è¯•æœºåˆ¶
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

### âœ… æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- çœŸå®æ•°æ®æµ‹è¯•

## æ–‡ä»¶å˜æ›´

### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/youtube_downloader.py`
   - æ–°å¢ `burn_subtitles_to_video()` å‡½æ•°
   - ä¿®æ”¹ `DownloadConfig` æ·»åŠ  `burn_subtitles` å­—æ®µ
   - ä¿®æ”¹ `process_single_url()` é›†æˆå­—å¹•çƒ§å½•
   - ä¿®æ”¹ `process_batch_urls()` ä¼ é€’é…ç½®
   - æ–°å¢å‘½ä»¤è¡Œå‚æ•° `--no-burn-subtitles`

2. `tests/test_youtube_downloader.py`
   - æ–°å¢ `TestSubtitleBurning` æµ‹è¯•ç±»
   - æ–°å¢ 5ä¸ªæµ‹è¯•ç”¨ä¾‹
   - å¯¼å…¥ `burn_subtitles_to_video` å‡½æ•°

### æ–°å¢çš„æ–‡ä»¶
1. `docs/SUBTITLE_BURN_GUIDE.md` - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
2. `docs/FFMPEG_SETUP.md` - FFmpegå®‰è£…æŒ‡å—  
3. `tests/SUBTITLE_BURN_TEST_SUMMARY.md` - æµ‹è¯•æŠ¥å‘Š
4. `SUBTITLE_BURN_FEATURE.md` - æœ¬æ–‡ä»¶ï¼ˆåŠŸèƒ½æ€»ç»“ï¼‰

## æ€§èƒ½æ•°æ®

### å¤„ç†æ—¶é—´
- 1åˆ†é’Ÿè§†é¢‘(480p): ~30ç§’
- 5åˆ†é’Ÿè§†é¢‘(480p): ~2.5åˆ†é’Ÿ
- å®é™…æ—¶é—´å–å†³äºç³»ç»Ÿæ€§èƒ½å’Œè§†é¢‘è´¨é‡

### æ–‡ä»¶å¤§å°
- åŸå§‹è§†é¢‘: åŸºå‡†
- å¸¦å­—å¹•è§†é¢‘: +10-30%
- æµ‹è¯•æ¡ˆä¾‹: 1.73MB â†’ 2.20MB (+27%)

### å¹¶å‘å¤„ç†
- é»˜è®¤3ä¸ªå¹¶å‘ä»»åŠ¡
- æ‰¹é‡å¤„ç†è‡ªåŠ¨å¹¶è¡Œ
- å¯é…ç½®å¹¶å‘æ•°

## å·²çŸ¥é™åˆ¶

1. **FFmpegä¾èµ–**
   - æŸäº›FFmpegç‰ˆæœ¬ç¼ºå°‘å­—å¹•æ»¤é•œ
   - å¤‡ç”¨æ–¹æ¡ˆåµŒå…¥å­—å¹•æµè€Œéçƒ§å½•åˆ°ç”»é¢

2. **å­—å¹•æ ¼å¼**
   - å½“å‰ä¸»è¦æ”¯æŒVTTæ ¼å¼
   - SRT/ASSæ”¯æŒå¾…å¼€å‘

3. **æ€§èƒ½å½±å“**
   - éœ€è¦é‡æ–°ç¼–ç è§†é¢‘
   - å¤„ç†æ—¶é—´ä¸è§†é¢‘é•¿åº¦æˆæ­£æ¯”

## æœªæ¥æ”¹è¿›

### çŸ­æœŸè®¡åˆ’
- [ ] æ”¯æŒæ›´å¤šå­—å¹•æ ¼å¼(SRT, ASS)
- [ ] å­—å¹•æ ·å¼UIé…ç½®
- [ ] ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ

### é•¿æœŸè®¡åˆ’
- [ ] å­—å¹•OCRè¯†åˆ«
- [ ] å­—å¹•è‡ªåŠ¨ç¿»è¯‘
- [ ] å®æ—¶é¢„è§ˆåŠŸèƒ½

## ç»“è®º

âœ… **åŠŸèƒ½å·²å®Œæ•´å®ç°å¹¶æµ‹è¯•é€šè¿‡**

- æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æµ‹è¯•è¦†ç›–å®Œæ•´
- æ–‡æ¡£è¯¦ç»†æ¸…æ™°
- ç”¨æˆ·ä½“éªŒè‰¯å¥½

å¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ï¼

## å¿«é€Ÿå¼€å§‹

```bash
# 1. ä¸‹è½½å¸¦å­—å¹•è§†é¢‘
python src/youtube_downloader.py "YOUR_VIDEO_URL" \
  --start 00:30 --end 02:00

# 2. æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls -lh downloads/*/

# 3. æ’­æ”¾å¸¦å­—å¹•çš„è§†é¢‘
vlc downloads/*/*_with_subs.mp4
```

## è·å–å¸®åŠ©

- ğŸ“– [å®Œæ•´ä½¿ç”¨æŒ‡å—](docs/SUBTITLE_BURN_GUIDE.md)
- ğŸ› ï¸ [FFmpegå®‰è£…](docs/FFMPEG_SETUP.md)
- ğŸ“Š [æµ‹è¯•æŠ¥å‘Š](tests/SUBTITLE_BURN_TEST_SUMMARY.md)

---

**å¼€å‘å®Œæˆæ—¥æœŸ**: 2025-10-10  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡ (41 passed, 1 skipped)  
**å¯ç”¨çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

