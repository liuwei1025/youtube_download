#!/bin/bash
# YouTubeä¸‹è½½å™¨ä¸€é”®æ‰§è¡Œè„šæœ¬ - æœ€ç»ˆç‰ˆæœ¬

# è®¾ç½®SOCKSä»£ç†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if netstat -an 2>/dev/null | grep -q ":7890.*LISTEN"; then
    export ALL_PROXY=socks5://127.0.0.1:7890
    export https_proxy=socks5://127.0.0.1:7890
    export http_proxy=socks5://127.0.0.1:7890
    echo "ğŸŒ æ£€æµ‹åˆ°SOCKSä»£ç†ï¼Œå·²è‡ªåŠ¨é…ç½®"
fi

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    echo "ğŸ¯ YouTubeä¸‹è½½å™¨ - ä¸€é”®æ‰§è¡Œç‰ˆ"
    echo ""
    echo "ä½¿ç”¨æ–¹æ³•:"
    echo "  $0 URL --start æ—¶é—´ --end æ—¶é—´ [é€‰é¡¹]"
    echo ""
    echo "ç¤ºä¾‹:"
    echo "  $0 \"https://www.youtube.com/watch?v=yJqOe-tKj-U\" --start 2:00 --end 3:00"
    echo "  $0 \"URL\" --start 120 --end 180 --no-video"
    echo "  $0 \"URL\" --start 2:00 --end 3:00 --sub-langs en,ja"
    echo ""
    echo "é€‰é¡¹:"
    echo "  --output-dir DIR     è¾“å‡ºç›®å½• (é»˜è®¤: downloads)"
    echo "  --no-video          ä¸ä¸‹è½½è§†é¢‘"
    echo "  --no-audio          ä¸ä¸‹è½½éŸ³é¢‘"
    echo "  --no-subtitles      ä¸ä¸‹è½½å­—å¹•"
    echo "  --sub-langs LANGS   å­—å¹•è¯­è¨€ï¼Œé€—å·åˆ†éš” (é»˜è®¤: zh-CN,zh,en,ja)"
    echo "                      ä¾‹å¦‚: en,ja æˆ– zh-CN,en"
    exit 0
fi

# æ£€æŸ¥å‚æ•°
if [[ $# -lt 3 ]]; then
    echo "âŒ å‚æ•°ä¸è¶³"
    echo "ä½¿ç”¨: $0 --help æŸ¥çœ‹å¸®åŠ©"
    exit 1
fi

# æ‰§è¡Œä¸»è„šæœ¬
echo "ğŸš€ å¯åŠ¨YouTubeä¸‹è½½å™¨..."
python3 "$(dirname "$0")/src/youtube_downloader.py" "$@" || exit 1

echo "âœ… æ‰§è¡Œå®Œæˆï¼"
exit 0