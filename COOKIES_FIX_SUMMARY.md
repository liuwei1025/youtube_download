# Cookie é…ç½®ä¿®å¤æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. Cookie å‚æ•°ä¼ é€’é—®é¢˜ 
**é—®é¢˜**: ä»£ç ä½¿ç”¨ `--cookies-from-browser chrome`ï¼Œä½† Docker å®¹å™¨å†…æ²¡æœ‰ Chrome æµè§ˆå™¨
**ä¿®å¤**: æ”¹ä¸ºä½¿ç”¨æœ¬åœ° cookies æ–‡ä»¶ `--cookies /app/cookies/Cookies`

### 2. å‚æ•°é¡ºåºé—®é¢˜
**é—®é¢˜**: ä½¿ç”¨ `insert()` æ–¹æ³•å¯¼è‡´å‚æ•°é¡ºåºæ··ä¹±
**ä¿®å¤**: ä½¿ç”¨ `extend()` æ–¹æ³•æ­£ç¡®æ·»åŠ å‚æ•°

### 3. yt-dlp è¾“å‡ºæ–‡ä»¶åé—®é¢˜
**é—®é¢˜**: è§†é¢‘/éŸ³é¢‘åˆ†ç¦»æµå¯¼è‡´"Fixed output name but more than one file to download"é”™è¯¯
**ä¿®å¤**: ä½¿ç”¨ `%(ext)s` æ¨¡æ¿è®© yt-dlp è‡ªåŠ¨å¤„ç†æ–‡ä»¶æ‰©å±•å

### 4. yt-dlp è¦†ç›– Cookies æ–‡ä»¶é—®é¢˜
**é—®é¢˜**: yt-dlp åœ¨é€€å‡ºæ—¶ä¼šä¿å­˜ cookiesï¼Œè¦†ç›–åŸå§‹æ–‡ä»¶
**ä¿®å¤**: 
- åˆ›å»º `entrypoint.sh` å¯åŠ¨è„šæœ¬
- åœ¨å®¹å™¨å¯åŠ¨æ—¶å¤åˆ¶ cookies åˆ° `/tmp/cookies_youtube`
- yt-dlp ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼ŒåŸå§‹æ–‡ä»¶ä¸ä¼šè¢«ç ´å

### 5. Python ç‰ˆæœ¬é—®é¢˜
**é—®é¢˜**: Python 3.9 å·²è¢« yt-dlp å¼ƒç”¨
**ä¿®å¤**: å‡çº§åˆ° Python 3.11

## âš ï¸ éœ€è¦ç”¨æˆ·æ“ä½œ

### é‡è¦ï¼šCookies æ–‡ä»¶å·²è¢«æŸå

æ‚¨çš„ `cookies/Cookies` æ–‡ä»¶å·²è¢« yt-dlp è¦†ç›–ï¼Œéœ€è¦é‡æ–°å¯¼å‡ºï¼š

#### é‡æ–°å¯¼å‡º Cookies çš„æ­¥éª¤ï¼š

1. **å®‰è£…æµè§ˆå™¨æ‰©å±•**
   - Chrome: "Get cookies.txt LOCALLY"
   - Firefox: "cookies.txt"

2. **å¯¼å‡º Cookies**
   - è®¿é—® https://www.youtube.com
   - ç¡®ä¿å·²ç™»å½•
   - ä½¿ç”¨æ‰©å±•å¯¼å‡º cookies
   - ä¿å­˜ä¸º `cookies/Cookies` æ–‡ä»¶ï¼ˆNetscape æ ¼å¼ï¼‰

3. **é‡æ–°æ„å»ºå¹¶å¯åŠ¨æœåŠ¡**
   ```bash
   cd /Users/liuwei/Github/youtube
   docker-compose build youtube-dl-api
   docker-compose up -d
   ```

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

1. `src/downloader/config.py` - æ·»åŠ  `cookies_file` å‚æ•°
2. `src/downloader/video.py` - ä¿®å¤ cookie ä¼ é€’å’Œæ–‡ä»¶åæ¨¡æ¿
3. `src/downloader/subtitle.py` - ä¿®å¤ cookie ä¼ é€’
4. `src/youtube_downloader.py` - æ·»åŠ  cookies å‚æ•°æ”¯æŒ
5. `app.py` - é…ç½® COOKIES_FILE ç¯å¢ƒå˜é‡
6. `Dockerfile` - å‡çº§ Pythonã€æ·»åŠ å¯åŠ¨è„šæœ¬
7. `entrypoint.sh` - æ–°æ–‡ä»¶ï¼šå¤åˆ¶ cookies åˆ°ä¸´æ—¶ä½ç½®
8. `docker-compose.yaml` - ç§»é™¤ cookies ç›®å½•çš„åªè¯»é™åˆ¶

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š
- âœ… æ²¡æœ‰ "could not find chrome cookies database" é”™è¯¯
- âœ… æ²¡æœ‰ "Python version 3.9 has been deprecated" è­¦å‘Š
- âœ… æ²¡æœ‰ "Sign in to confirm you're not a bot" é”™è¯¯
- âœ… è§†é¢‘/éŸ³é¢‘/å­—å¹•æ­£å¸¸ä¸‹è½½

## ğŸ” æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶å‡ºç° "Sign in to confirm" é”™è¯¯ï¼š

1. ç¡®è®¤ cookies æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆNetscape æ ¼å¼ï¼‰
2. ç¡®è®¤ cookies æœªè¿‡æœŸï¼ˆé‡æ–°å¯¼å‡ºï¼‰
3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š
   ```bash
   docker-compose logs youtube-dl-api --tail 100
   ```

### æŸ¥çœ‹ cookies æ˜¯å¦æ­£ç¡®åŠ è½½ï¼š

```bash
docker exec youtube-dl-api cat /tmp/cookies_youtube | head -5
```

åº”è¯¥çœ‹åˆ°å®Œæ•´çš„ cookies å†…å®¹ï¼Œè€Œä¸æ˜¯ "This file is generated by yt-dlp"ã€‚

## ğŸ“ æµ‹è¯•å‘½ä»¤

```bash
curl -X POST "http://localhost:8000/download" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.youtube.com/watch?v=jNQXAC9IVRw",
    "start_time": "00:05",
    "end_time": "00:15",
    "download_video": true,
    "download_audio": false,
    "download_subtitles": false
  }'
```

æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š
```bash
# æ›¿æ¢ TASK_ID ä¸ºå®é™…çš„ä»»åŠ¡ ID
curl "http://localhost:8000/tasks/TASK_ID"
```

